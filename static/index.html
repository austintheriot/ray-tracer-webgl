<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ray Tracer WebGL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="/main.js" defer></script>
    <style>
        canvas {
            width: 100%;
            max-width: 100vw;
            image-rendering: pixelated;
            object-fit: contain;
        }
    </style>
</head>

<body>
    <canvas></canvas>
    <button>Save Image</button>
    <script id="vertex-shader" type="x-shader/x-vertex">#version 300 es
        in vec4 a_position;

        out vec2 v_position;

        void main() {
            v_position = a_position.xy;
            gl_Position = a_position;
        }
      </script>

    <script id="fragment-shader" type="x-shader/x-fragment">#version 300 es
        precision highp float;

        uniform float u_width;
        uniform float u_height;

        struct Ray {
            vec3 origin;
            vec3 direction;
        };

        out vec4 o_color;

        in vec2 v_position;

        vec3 ray_color(in Ray r) {
            vec3 unit_direction = normalize(r.direction);
            float t = 0.5 * (unit_direction.y + 1.0);
            return mix(vec3(1.0, 1.0, 1.0), vec3(0.5, 0.7, 1.0), t);
        }
        
        void main() {
            // these could be initialized as uniforms
            float aspect_ratio = u_width / u_height;
            float viewport_height = 2.0;
            float viewport_width = aspect_ratio * viewport_height;
            float focal_length = 1.0;
            vec3 camera_origin = vec3(0.);
            vec3 viewport_horizontal_vec = vec3(viewport_width, 0., 0.);
            vec3 viewport_vertical_vec = vec3(0., viewport_height, 0.);
            vec3 lower_left_corner = camera_origin - viewport_horizontal_vec / 2. - viewport_vertical_vec / 2. - vec3(0., 0., focal_length);

            // map from -1->1 to 0->1
            vec2 uv = (v_position + 1.) * 0.5;
            
            // create ray from camera origin to viewport
            vec3 ray_direction = lower_left_corner + uv.x * viewport_horizontal_vec + uv.y * viewport_vertical_vec - camera_origin;
            Ray r = Ray(camera_origin, ray_direction);
            
            // determine color by shooting ray
            vec3 color = ray_color(r);

            o_color = vec4(color, 1.);
          }
      </script>
</body>

</html>